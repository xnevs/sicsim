nal1	START	0
	JSUB	SINIT
	
LOOP	TD	FA
	JEQ	LOOP
	RD	FA
	COMP	#0
	JEQ	HALT
	JSUB	echonum

	STA	@SPTR
	LDA	#32
	WD	STDOUT
	LDA	@SPTR

	JSUB	fak
	JSUB	echonum
	LDA	#10
	WD	STDOUT
	J	LOOP

HALT	J	HALT

fak	COMP	#1
	JEQ	KONEC
	STL	@SPTR
	JSUB	SPUSH

	STA	@SPTR
	JSUB	SPUSH

	SUB	#1
	JSUB	fak
	
	JSUB	SPOP
	MUL	@SPTR

	JSUB	SPOP
	LDL	@SPTR
KONEC	RSUB


echonum	STL	@SPTR
	JSUB	SPUSH
	STA	@SPTR
	JSUB	SPUSH
	STX	@SPTR
	JSUB	SPUSH
	STS	@SPTR
	JSUB	SPUSH

	LDX	#0
	LDS	#1

NLOOP1	STA	@SPTR
	JSUB	SPUSH
	JSUB	MOD
	ADD	#48
	STCH	NUMSTR,X
	ADDR	S,X
	JSUB	SPOP
	LDA	@SPTR
	DIV	#10
	COMP	#0
	JEQ	NLOOP2
	J	NLOOP1

NLOOP2	SUBR	S,X
	LDCH	NUMSTR,X
	WD	STDOUT
	CLEAR	A
	ADDR	X,A
	COMP	#0
	JGT	NLOOP2

	JSUB	SPOP
	LDS	@SPTR
	JSUB	SPOP
	LDX	@SPTR
	JSUB	SPOP
	LDA	@SPTR
	JSUB	SPOP
	LDL	@SPTR
	RSUB

NUMSTR	RESB	7
	
MOD	STL	@SPTR
	JSUB	SPUSH
	STS	@SPTR
	JSUB	SPUSH

	CLEAR	S
	ADDR	A,S
	DIV	#10
	MUL	#10
	SUBR	A,S
	CLEAR	A
	ADDR	S,A

	JSUB	SPOP
	LDS	@SPTR
	JSUB	SPOP
	LDL	@SPTR
	RSUB

SINIT	STA	TMP
	LDA	#STACK
	STA	SPTR
	LDA	TMP
	RSUB

SPUSH	STA	TMP
	LDA	SPTR
	ADD	#3
	STA	SPTR
	LDA	TMP
	RSUB

SPOP	STA TMP
	LDA	SPTR
	SUB	#3
	STA	SPTR
	LDA	TMP
	RSUB

TMP	RESW	1
SPTR	RESW	1
STACK	RESW	100

FA	BYTE	0xFA
STDOUT	BYTE	1
